<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- 安全相关 -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />

    <title>React H5 Web</title>
    <meta
      name="description"
      content="基于 React 19 的现代化移动端应用框架，支持 TypeScript、Vite、UnoCSS，提供优秀的开发体验和性能优化"
    />

    <!-- DNS 预解析 -->
    <link rel="dns-prefetch" href="https://cdn.bootcdn.net" />

    <!-- 关键 CSS 内联 - 首屏必需样式 -->
    <style>
      /* CSS 变量 - 默认主题 */
      :root {
        --color-primary: #2563eb;
        --color-primary-light: #3b82f6;
        --color-primary-dark: #1d4ed8;
        --color-bg: #fff;
        --color-bg-secondary: #f9fafb;
        --color-text: #111827;
        --color-text-secondary: #6b7280;
        --color-border: #e5e7eb;
        --color-success: #10b981;
        --color-error: #ef4444;
        --color-warning: #f59e0b;
      }

      /* 基础重置 */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        color: var(--color-text);
        background-color: var(--color-bg);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* 防止 FOUC（无样式内容闪烁） */
      #root:empty {
        min-height: 100vh;
        background-color: var(--color-bg);
      }

      /* 加载动画 */
      .app-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100vw;
        height: 100vh;
        background-color: var(--color-bg);
      }

      .app-loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid var(--color-border);
        border-top-color: var(--color-primary);
        border-radius: 50%;
        animation: spinner 0.8s linear infinite;
      }

      @keyframes spinner {
        to {
          transform: rotate(360deg);
        }
      }

      /* 移动端优化 */
      html {
        -webkit-tap-highlight-color: transparent;
      }

      /* 安全区域适配 */
      @supports (padding: env(safe-area-inset-top)) {
        #root {
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
        }
      }
    </style>

    <!-- 预加载关键资源 -->
    <link rel="modulepreload" href="/src/main.tsx" />

    <!-- 如果使用 CDN -->
    <% if (VITE_CDN === true) { %>
    <link rel="preconnect" href="https://cdn.bootcdn.net" crossorigin />
    <% } %>
  </head>
  <body>
    <div id="root">
      <!-- 加载指示器 -->
      <div class="app-loading">
        <div class="app-loading-spinner"></div>
      </div>
    </div>

    <!-- 移动端视口高度修复 -->
    <script>
      // 修复移动端 100vh 问题
      const setVh = () => {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty("--vh", `${vh}px`);
      };
      setVh();
      window.addEventListener("resize", setVh);
      window.addEventListener("orientationchange", setVh);
    </script>

    <script type="module" src="/src/main.tsx"></script>

    <!-- Service Worker 延迟注册 -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker.register("/registerSW.js").catch(() => {});
        });
      }
    </script>
  </body>
</html>
